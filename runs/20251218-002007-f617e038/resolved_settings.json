{
  "banned_token_ids": [
    3,
    4,
    5
  ],
  "generated_at_utc": "2025-12-18T00:20:07.549189+00:00",
  "model_cfg": {
    "C": 64,
    "H": 2,
    "L": 2,
    "T": 32,
    "V": 256,
    "d_ff": 128,
    "dropout": 0.1,
    "rope_theta": 10000.0
  },
  "overrides": {
    "model": {
      "C": 64,
      "H": 2,
      "L": 2,
      "T": 32,
      "V": 256,
      "d_ff": 128
    },
    "training": {
      "pretrain": {
        "accum_steps": 2,
        "activation_checkpointing": false,
        "amp": false,
        "amp_dtype": "fp16",
        "base_lr": 0.001,
        "ckpt_every": 2,
        "eval_every": 2,
        "eval_steps": 2,
        "grad_clip": 1.0,
        "log_every": 1,
        "micro_B": 4,
        "min_lr": 0.0001,
        "seed": 42,
        "total_steps": 2,
        "warmup_steps": 1
      }
    }
  },
  "overrides_source": "configs/pretrain_smoke.json",
  "phase": "pretrain",
  "run_id": "20251218-002007-f617e038",
  "settings": {
    "benchmark": {
      "binary_search_max_micro_B": 256,
      "candidate_T": [
        512,
        1024
      ],
      "candidate_model_dims": [
        {
          "C": 384,
          "H": 6,
          "L": 8
        },
        {
          "C": 512,
          "H": 8,
          "L": 8
        },
        {
          "C": 512,
          "H": 8,
          "L": 12
        }
      ],
      "checkpointing_modes": [
        false,
        true
      ],
      "lr": 0.0003,
      "max_micro_B": 256,
      "seed": 42,
      "steps_measure": 10,
      "steps_warmup": 2,
      "timeout_s": 20.0
    },
    "data": {
      "allow_missing_idx": false,
      "caches": {
        "pretrain_token_cache": "/Users/nnandal/Documents/code/niels-gpt/data/cache/pretrain",
        "raw_cache_dir": "/Users/nnandal/Documents/code/niels-gpt/data/cache/hf",
        "sft_token_cache": "/Users/nnandal/Documents/code/niels-gpt/data/cache/sft",
        "streams_token_cache": "/Users/nnandal/Documents/code/niels-gpt/data/cache/streams"
      },
      "chunking": {
        "pack_to_T": true,
        "stride": 1
      },
      "dolly": {
        "dataset_id": "databricks/databricks-dolly-15k",
        "include_system": false,
        "max_examples": null,
        "split": "train"
      },
      "fineweb_edu": {
        "chunking": {
          "pack_to_T": true,
          "stride": 1
        },
        "dataset_id": "HuggingFaceFW/fineweb-edu",
        "max_bytes": null,
        "max_examples": null,
        "max_tokens": null,
        "name": "CC-MAIN-2024-10",
        "shuffle": true,
        "split": "train",
        "streaming": true
      },
      "gutenberg": {
        "chunking": {
          "pack_to_T": true,
          "stride": 1
        },
        "dataset_id": "nikolina-p/gutenberg_clean_en_splits",
        "max_bytes": null,
        "max_examples": null,
        "max_tokens": null,
        "shuffle": true,
        "split": "train",
        "streaming": true
      },
      "mix_pretrain": {
        "fineweb_edu": 0.72,
        "roam": 0.1,
        "wikitext": 0.18
      },
      "mix_sft": {
        "dolly": 0.2,
        "oasst1": 0.6,
        "primer": 0.2
      },
      "oasst1": {
        "dataset_id": "OpenAssistant/oasst1",
        "english_only": true,
        "max_messages": 32,
        "shuffle_trees": true,
        "split": "train",
        "take_trees": null
      },
      "primer": {
        "delimiter": "\n\n<dialogue>\n\n",
        "path": "/Users/nnandal/Documents/code/niels-gpt/data/primer.txt",
        "seed": 42,
        "val_frac": 0.1
      },
      "roam": {
        "chunking": {
          "pack_to_T": true,
          "stride": 1
        },
        "glob_pattern": "**/*.md",
        "root_dir": "/Users/nnandal/Documents/code/niels-gpt/.roam-data",
        "split_seed": 42,
        "val_frac": 0.1
      },
      "val_pretrain_source": "wikitext",
      "val_sft_source": "wikitext",
      "wikitext": {
        "chunking": {
          "pack_to_T": true,
          "stride": 1
        },
        "config": "wikitext-103-raw-v1",
        "dataset_id": "wikitext",
        "max_bytes": null,
        "max_examples": null,
        "max_tokens": null,
        "streaming": false,
        "test_split": "test",
        "train_split": "train",
        "val_split": "val"
      }
    },
    "generation": {
      "banned_token_ids": null,
      "max_new_tokens": 256,
      "repetition_penalty": null,
      "stop_token_id": null,
      "temperature": 0.9,
      "top_k": 50,
      "top_p": null
    },
    "model": {
      "C": 64,
      "H": 2,
      "L": 2,
      "T": 32,
      "V": 256,
      "attention": {
        "attn_type": "mha",
        "kv_cache_dtype": "fp16",
        "use_kv_cache": true
      },
      "d_ff": 128,
      "dropout": 0.1,
      "mlp_type": "swiglu",
      "norm_type": "rmsnorm",
      "rope_theta": 10000.0
    },
    "reproducibility": {
      "dataset_shuffle_buffer_size": 10000,
      "torch_matmul_precision": null,
      "torch_num_threads": null
    },
    "sft_format": {
      "allow_truncate_mid_turn": true,
      "assistant_only_loss": true,
      "ban_role_tokens_during_generation": true,
      "include_eot_in_loss": false,
      "pack_sequences": true,
      "packing_policy": "prefer_boundary_allow_truncate",
      "require_eot": true
    },
    "tokenizer": {
      "byte_fallback": true,
      "expected_special_token_ids": {
        "asst": 5,
        "eot": 6,
        "sys": 3,
        "usr": 4
      },
      "model_path": "/Users/nnandal/Documents/code/niels-gpt/artifacts/tokenizer/v2/spm.model",
      "normalization": "nfkc",
      "special_tokens": {
        "asst": "<|ngpt_asst_84a5023f67d74cf29cc4001becde983c|>",
        "eot": "<|ngpt_eot_84a5023f67d74cf29cc4001becde983c|>",
        "sys": "<|ngpt_sys_84a5023f67d74cf29cc4001becde983c|>",
        "usr": "<|ngpt_usr_84a5023f67d74cf29cc4001becde983c|>"
      },
      "tokenizer_sha256": "a7ccda70ba310e6571295e6833dd6c340a906c5506cb1391ca0aeb7aba20c762",
      "tokenizer_type": "bpe",
      "vocab_size": 16000
    },
    "training": {
      "pretrain": {
        "accum_steps": 2,
        "activation_checkpointing": false,
        "amp": false,
        "amp_dtype": "fp16",
        "base_lr": 0.001,
        "best_metric": "pretrain_val_loss",
        "best_metric_weights": null,
        "betas": [
          0.9,
          0.95
        ],
        "ckpt_every": 2,
        "decay_embeddings": true,
        "decay_norm_and_bias": true,
        "eps": 1e-08,
        "eval_batches": null,
        "eval_every": 2,
        "eval_steps": 2,
        "grad_clip": 1.0,
        "log_every": 1,
        "micro_B": 4,
        "micro_B_eval": null,
        "min_lr": 0.0001,
        "optimizer": "adamw",
        "save_best": true,
        "seed": 42,
        "total_steps": 2,
        "warmup_steps": 1,
        "weight_decay": 0.1
      },
      "sft": {
        "accum_steps": 1,
        "activation_checkpointing": false,
        "amp": true,
        "amp_dtype": "fp16",
        "base_lr": 0.0001,
        "best_metric": "sft_val_loss",
        "best_metric_weights": null,
        "betas": [
          0.9,
          0.95
        ],
        "ckpt_every": 1000,
        "decay_embeddings": true,
        "decay_norm_and_bias": true,
        "eps": 1e-08,
        "eval_batches": null,
        "eval_every": 200,
        "eval_steps": 50,
        "grad_clip": 1.0,
        "log_every": 50,
        "micro_B": 16,
        "micro_B_eval": null,
        "min_lr": 1e-05,
        "optimizer": "adamw",
        "save_best": true,
        "seed": 42,
        "total_steps": 6000,
        "warmup_steps": 120,
        "weight_decay": 0.05
      }
    }
  },
  "special_token_ids": {
    "asst": 5,
    "eot": 6,
    "sys": 3,
    "usr": 4
  },
  "stop_token_id": 6,
  "tokenizer": {
    "meta": {
      "bos_id": 1,
      "eos_id": 2,
      "expected_special_token_ids": {
        "asst": 5,
        "eot": 6,
        "sys": 3,
        "usr": 4
      },
      "pad_id": -1,
      "unk_id": 0
    },
    "model_path": "/Users/nnandal/Documents/code/niels-gpt/artifacts/tokenizer/v2/spm.model",
    "sha256": "a7ccda70ba310e6571295e6833dd6c340a906c5506cb1391ca0aeb7aba20c762",
    "special_tokens": {
      "asst": "<|ngpt_asst_84a5023f67d74cf29cc4001becde983c|>",
      "eot": "<|ngpt_eot_84a5023f67d74cf29cc4001becde983c|>",
      "sys": "<|ngpt_sys_84a5023f67d74cf29cc4001becde983c|>",
      "usr": "<|ngpt_usr_84a5023f67d74cf29cc4001becde983c|>"
    }
  },
  "train_cfg": {
    "B": 4,
    "accum_steps": 2,
    "activation_checkpointing": false,
    "amp": false,
    "amp_dtype": "fp16",
    "base_lr": 0.001,
    "best_metric": "pretrain_val_loss",
    "best_metric_weights": null,
    "beta1": 0.9,
    "beta2": 0.95,
    "ckpt_every": 2,
    "decay_embeddings": true,
    "decay_norm_and_bias": true,
    "eps": 1e-08,
    "eval_batches": null,
    "eval_every": 2,
    "eval_steps": 2,
    "grad_clip": 1.0,
    "log_every": 1,
    "micro_B_eval": null,
    "min_lr": 0.0001,
    "optimizer": "adamw",
    "save_best": true,
    "seed": 42,
    "total_steps": 2,
    "warmup_steps": 1,
    "weight_decay": 0.1
  }
}